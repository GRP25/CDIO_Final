<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <link href="https://unpkg.com/tailwindcss@%5E1.0/dist/tailwind.min.css" rel="stylesheet">
  <script src="jquery-2.1.1.min.js"></script>


</head>
  <body>
    <div class="bg-gray-600">
      <!--Sidebar-->
      <div class="fixed top-0 bottom0 w-1/3 flex flex-row">
        <!--Circle bar-->
        <div class="w-1/4 h-screen bg-gray-800 flex flex-col p-2">
          <div onclick="" class="cursor-pointer w-20 h-20 rounded-full bg-blue-400 hover:bg-blue-500 text-center p-2">
            Productions lederen
          </div>
        </div>

        <!--Filter bar-->
        <div class="w-3/4 bg-gray-900 pt-10 p-2 flex-row p-5">
          <button onclick="" class=" w-30 h-30 rounded-full bg-gray-400 hover:bg-gray-500 text-center p-5 m-5">
            Råvarebatch-administration
          </button>
          <button onclick="" class=" w-30 h-30 rounded-full bg-gray-400 hover:bg-gray-500 text-center p-5 m-5">
            Produktbatch-administration
          </button>
          <button onclick="" class=" w-30 h-30 rounded-full bg-gray-400 hover:bg-gray-500 text-center p-5 m-5">
            Afvejning-adminstration
          </button>
          <button onclick="" class=" w-30 h-30 rounded-full bg-gray-400 hover:bg-gray-500 text-center p-5 m-5">
            Exit
          </button>
        </div>
      </div>

      <!--Container-->
      <div class="w-2/3 ml-auto h-screen p-6">

        <div class="h-auto w-full bg-gray-800 my-10 rounded-lg">
          <div class="flex">
            <!--Search Bar-->
            <div class="p-2" >
              <button onclick="getCommodityBatchList()" class="cursor-pointer m-4 bg-blue-300 hover:bg-blue-400 rounded-full">Show All Elements</button>
              <button onclick="showCommodityField()" class=" cursor-pointer m-4 bg-blue-300 hover:bg-blue-400 rounded-full">Show Elements by Commidty's id</button>
              <button onclick="showAddModal(true)" class="cursor-pointer m-4 bg-blue-300 hover:bg-blue-400 rounded-full">OPRET</button>

            </div>
            <div class="justify-end p-6 ml-20">
              <input onkeyup="searchForElement()" id="search-input" type="text" class="rounded-full bg-gray-300" placeholder="  Search..">
            </div>
          </div>
          <!--Body showElementsAuto()-->
          <div  class="text-black bg-gray-400 rounded-lg">

            <!--Display guiding bar if there is no elements in list -->
            <div id="guiding-bar" class="flex justify-center">
                Try to click on Show All Elements button to display elements.
            </div>

            <!--Display list of elements-->
            <div id="commodityBatch-list">

            </div>
          </div>
        </div>

        <!--Input commodity id to show a list of elements -->
        <div id="commodity_modal-view" class="hidden flex-col  items-center  h-screen w-1/3">
          <!--Information field-->
          <div class="bg-gray-300 p-3">
            <label>
              Commodity Id
              <input class="w-full" type="text"  id="commodity_modal_id-input">
            </label>
          </div>
          <!--Create and Cancel buttons-->
          <div class="flex flex-col">
            <button onclick="hideModal()" class="cursor-pointer bg-red-200">Cancel</button>
            <button id="modal-enter" onclick="getCommodityList()" class="cursor-pointer bg-blue-200">Enter</button>
          </div>
        </div>

        <!--Add information by user to commodityBatch-->
        <div id="modal-view" class="hidden flex-col  items-center  h-screen">
          <!--Information field-->
          <div class="bg-gray-300 w-1/3 p-3">
            <label>
              Commodity Batch Id
              <input class="w-full" type="text"  id="commodityBatch_id-input">
            </label>
            <label>
              Commodity Id
              <input class="w-full" type="text"  id="commodity_id-input">
            </label>
            <label>
              Weight
              <input class="w-full" type="text"  id="weight-input">
            </label>
            <label>
              Supplier
              <input class="w-full" type="text"  id="supplier-input">
            </label>
          </div>

          <!--Create and Cancel buttons-->
          <div class="flex flex-row justify-end">
            <button onclick="hideModal()" class="cursor-pointer bg-red-200">Cancel</button>
            <button id="modal-add" onclick="addElement()" class="cursor-pointer bg-blue-200">Add Element</button>
            <button id="modal-update" onclick="updateElement(document.getElementById('commodityBatch_id-input').value)"  class="cursor-pointer bg-blue-200 hidden">Update Element</button>
          </div>
        </div>

      </div>
    </div>

    <script>

      /*****************************************************
       *                    JavaScript                     *
       *****************************************************/
      let elements =  [];

      /** Show modal to add an object */
      function showAddModal(showAddButton) {
        hideModal(false);
        document.getElementById('modal-view').style.display = 'flex';

        if (showAddButton) {
          document.getElementById('modal-add').style.display = 'block';
          document.getElementById('modal-update').style.display = 'none';
          document.getElementById('commodity_modal-view').style.display = 'none'
          // To allow user to write in id field
          document.getElementById('commodityBatch_id-input').disabled = false
        }
      }


      /** To hide modal and make fields empty */
      function hideModal(updateButton) {
        document.getElementById('modal-view').style.display = 'none'
        document.getElementById('commodity_modal-view').style.display = 'none'


        if (updateButton)
          document.getElementById('modal-update').style.display = 'none';

        // Make the fields empty
        document.getElementById('commodityBatch_id-input').value = ''
        document.getElementById('commodity_id-input').value = ''
        document.getElementById('weight-input').value = ''
        document.getElementById('supplier-input').value = ''
        document.getElementById('commodity_modal_id-input').value = ''

      }


      /** Show element information */
      function showElementInfo(commodityBatch_id, showUpdateButton){
        let element;

        // To update
        if (commodityBatch_id != 0) {
          element = elements[
                  elements.findIndex(element => element.commodityBatch_id == commodityBatch_id)]
        }

        // To hide modals
        showAddModal(false);
        document.getElementById('modal-add').style.display = 'none'
        document.getElementById('modal-update').style.display = 'none'
        document.getElementById('commodity_modal-view').style.display = 'none'
        // To make field empty
        document.getElementById('commodityBatch_id-input').value = '';


        if (showUpdateButton) {
          // To not allow user to write in id field
          document.getElementById('commodityBatch_id-input').disabled = true
          document.getElementById('modal-update').style.display = 'block'
          document.getElementById('commodityBatch_id-input').value = element.commodityBatch_id;
          document.getElementById('commodity_id-input').value = element.commodity_id;
          document.getElementById('weight-input').value = element.weight;
          document.getElementById('supplier-input').value = element.supplier;
        }



      }

      /** To hide all modals */
      function hideAllModel() {
        document.getElementById('modal-add').style.display = 'none'
        document.getElementById('modal-update').style.display = 'none'
        document.getElementById('commodity_modal-view').style.display = 'none'
        document.getElementById('modal-view').style.display = 'none';
      }



      function showCommodityField() {
        document.getElementById('modal-view').style.display = 'none'
        document.getElementById('modal-update').style.display = 'none'
        document.getElementById('commodity_modal-view').style.display = 'block'
      }

      function getCommodityList() {
        const commodityId = document.getElementById('commodity_modal_id-input').value;
        getCommodityBatchListByCommodityId(commodityId)

        // To hide the modal after creating an object
        hideModal()
      }

      /** Search for element */
      function searchForElement() {
        var searchById = document.getElementById('search-input').value
        let element = elements[elements.findIndex(element => element.commodityBatch_id == searchById)]
        showElementsAuto(element)
      }

      /** To Show all elements */
      function showElementsAuto(elements) {
        showElementInfo(0, false);
        // To hide all modal
        hideAllModel();

        // To hide guiding bar
        if (elements.length > 0) document.getElementById('guiding-bar').style.display = 'none'


        const single_element = document.getElementById('commodityBatch-list');
        single_element.innerText = ''

        let element;
        if (elements.length > 1) {
          for (element of elements) {
            single_element.insertAdjacentHTML('beforeend', `
                                                        <div class="bg-gray-400 flex p-2">
                                                        <div class="cursor-pointer text-green-600">ID: ${element.commodityBatch_id} </div>
                                                        <div class="ml-auto">
                                                        <button onclick="getElement('${element.commodityBatch_id}')" class="cursor-pointer text-green-600 pr-2">Show Element Information</button>
                                                        <button onclick="showElementInfo('${element.commodityBatch_id}', true)" class="cursor-pointer text-green-600">Update Element</button>
                                                        </div>
                                                        </div>
                                                        `)
          }
        }else {
            // For searching bar
            single_element.insertAdjacentHTML('beforeend', `
                                                        <div class="bg-gray-400 flex p-2">
                                                        <div class="cursor-pointer text-green-600">ID: ${elements.commodityBatch_id} </div>
                                                        <div class="ml-auto">
                                                        <button onclick="getElement('${elements.commodityBatch_id}')" class="cursor-pointer text-green-600 pr-2">Show Element Information</button>
                                                        <button onclick="showElementInfo('${elements.commodityBatch_id}', true)" class="cursor-pointer text-green-600">Update Element</button>
                                                        </div>
                                                        </div>
                                                        `)
        }
      }



      /*****************************************************
       *               JavaScript with Ajax                *
       *****************************************************/

      function getCommodityBatchList() {
        elements = [];
        let element;
        console.log("getCommodityBatchList method")
        $.ajax({
          url  : 'https://api.mama.sh/commodityBatch',
          contentType : "application/json",
          type : "GET",
          success : function (response) {
            for (element of response) {
              elements.push(element)
            }
            showElementsAuto(elements)
          },
          error: function (jqXHR, text, error) {
            alert(jqXHR.status + text + error);
          }
        });

      }



      function getCommodityBatchListByCommodityId(commodity_id) {
        // Input's user Validation
        idValidation(commodity_id);

        elements = [];
        let element;
        console.log("getCommodityBatchList method")
        $.ajax({
          url  : 'https://api.mama.sh/commodityBatch/list/' + commodity_id,
          contentType : "application/json",
          type : "GET",
          success : function (response) {
            for (element of response) {
              elements.push(element)
            }
            showElementsAuto(elements)
          },
          error: function (jqXHR, text, error) {
            alert(jqXHR.status + text + error);
          }
        });

      }



      /** Show element information */
      function getElement(commodityBatch_id) {
        console.log("getElement method");

        $.ajax({
          url  : 'https://api.mama.sh/commodityBatch/' + commodityBatch_id,
          contentType : "application/json",
          type : "GET",
          success : function (response) {
            document.getElementById('modal-add').style.display = 'none';
            $('#commodityBatch_id-input').val(response.commodityBatch_id);
            $('#commodity_id-input').val(response.commodity_id);
            $('#weight-input').val(response.weight);
            $('#supplier-input').val(response.supplier)
          },
          error: function (jqXHR, text, error) {
            alert(jqXHR.status + text + error)
          }
        });

        // To hide other windows og show element information
        showElementInfo(0, false);
      }

      /** Add element to dataBase */
      function addElement() {
        let element;

        // Store user input in variables
        let commodityBatch_id = document.getElementById('commodityBatch_id-input').value;
        let commodity_id = document.getElementById('commodity_id-input').value;
        let weight = document.getElementById('weight-input').value;
        let supplier = document.getElementById('supplier-input').value;

        // To add attributes to data base if all attributes are not empty
        if (commodityBatch_id && commodity_id && weight && supplier) {
          // Input's user Validation
          if (idValidation(commodityBatch_id) && idValidation(commodity_id) && doubleValidation(weight) && stringValidation(supplier)) {
            element = {
              commodityBatch_id: commodityBatch_id,
              commodity_id: commodity_id,
              weight: weight,
              supplier: supplier
            };

            $.ajax({
              url: 'https://api.mama.sh/commodityBatch',
              method: 'POST',
              contentType: "application/json",
              data: JSON.stringify(element),
              success: function (response) {
                alert(JSON.stringify(response))
                // Display elements
                getCommodityBatchList()
              },
              error: function (jqXHR, textStatus, error) {
                alert(jqXHR.responseText + textStatus + error.toString())
              }
            });
          }
        }else {
          alert("Please input values for all fields:) ")

        }



        // To hide the modal after creating an object
        hideModal()
      }


      /** Update element */
      function updateElement(commodityBatch_id) {
        let element;

        // Store user input in variables
        let commodity_id = document.getElementById('commodity_id-input').value;
        let weight = document.getElementById('weight-input').value;
        let supplier = document.getElementById('supplier-input').value;

        // To add attributes to data base if all attributes are not empty
        if (commodityBatch_id && commodity_id && weight && supplier) {
          // Input's user Validation
            if (idValidation(commodity_id) && doubleValidation(weight) && stringValidation(supplier)) {
              // Store variables in element object
              element = {
                commodityBatch_id: commodityBatch_id,
                commodity_id: commodity_id,
                weight: weight,
                supplier: supplier
              };



              $.ajax({
                url: 'https://api.mama.sh/commodityBatch',
                contentType: "application/json",
                method: 'PUT',
                data: JSON.stringify(element),
                success: function (response) {
                  alert(JSON.stringify(response))
                },
                error: function (jqXHR, textStatus, error) {
                  alert(jqXHR.responseText + textStatus + error.toString())
                }
              });
            }
        }else {
          alert("Please input values for all fields:) ")
        }

        // To hide the modal after creating an object
        hideModal(true)

      }


      /*****************************************************
       *                    Validation                     *
       *****************************************************/

      function idValidation(id) {
        var num = /^[0-9]+$/;
        if (!id.match(num) || id < 1 || id > 99999999) {
          alert("The input must be an integer number and " +
                            "between  1 - 99999999 in id's field");
          return false;
        }
        return true;
      }

      function stringValidation(string) {
        var str = /^[a-zA-Z0-9åÅæÆøØ]+$/;
        if (!string.match(str)) {
          alert("Special character is not allow in supplier's field");
          return false;
        }
        return true;
      }

      function doubleValidation(number) {
        var num =/^([0-9]+.{0,1}[0-9]*,{0,1})*[0-9]+$/;
        if (!number.match(num)) {
          alert("The input must be a number in weight's field");
          return false;
        }
        return true;
      }



    </script>
  </body>
</html>