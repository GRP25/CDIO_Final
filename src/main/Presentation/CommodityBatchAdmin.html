<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="https://unpkg.com/tailwindcss@%5E1.0/dist/tailwind.min.css" rel="stylesheet">
    <script src="jquery-2.1.1.min.js"></script>


</head>
    <body>
        <div>
            <!--Sidebar-->
            <div class="fixed top-0 bottom0 w-1/3 flex flex-row">
                <!--Circle bar-->
                <div class="w-1/4 h-screen bg-gray-800 flex flex-col p-2">
                    <div onclick="" class="cursor-pointer w-20 h-20 rounded-full bg-blue-400 hover:bg-blue-500 text-center p-2">
                        Productions lederen
                    </div>
                </div>

                <!--Filter bar-->
                <div class="w-3/4 bg-gray-900 pt-10 p-2">
                    <div onclick="" class="cursor-pointer w-30 h-30 rounded-full bg-gray-400 hover:bg-gray-500 text-center p-5">
                        CommodityBatch
                    </div>
                </div>
            </div>

            <!--Container-->
            <div class="w-2/3 ml-auto h-screen">

                 <div class="h-auto w-full bg-gray-800 my-10 ">
                     <!--Search Bar-->
                     <div class="p-2 flex justify-end" >
                         <input type="text" class="rounded-full">
                         <button class="cursor-pointer m-4 bg-blue-300 rounded-full">SÃ˜G</button>
                         <button onclick="showModal(true)" class="cursor-pointer m-4 bg-blue-300 rounded-full">OPRET</button>
                     </div>
                        <!--Body showElementsAuto()-->
                     <div class="text-black">
                         <div id="commodityBatch-list">

                         </div>
                     </div>
                 </div>


                <!--Add information by user to commodityBatch-->
                <div id="modal-view" class="hidden flex-col  items-center  h-screen">
                    <!--Information field-->
                    <div class="bg-gray-300 w-1/3 p-3">
                        <label>
                            Commodity Batch Id
                            <input class="w-full" type="text"  id="commodityBatch_id-input">
                        </label>
                        <label>
                            Commodity Id
                            <input class="w-full" type="text"  id="commodity_id-input">
                        </label>
                        <label>
                            Weight
                            <input class="w-full" type="text"  id="weight-input">
                        </label>
                        <label>
                            Supplier
                            <input class="w-full" type="text"  id="supplier-input">
                        </label>
                    </div>

                    <!--Create and Cancel buttons-->
                    <div class="flex flex-row justify-end">
                        <button onclick="hideModal()" class="cursor-pointer bg-red-200">Cancel</button>
                        <button id="modal-add" onclick="addElement()" class="cursor-pointer bg-blue-200">Add Element</button>
                        <button id="modal-update" onclick="updateElement(document.getElementById('commodityBatch_id-input').value)"  class="cursor-pointer bg-blue-200">Update Element</button>

                    </div>
                </div>

            </div>
        </div>

    <script>


        let elements =  [
            // {
            //     commodityBatch_id: 1,
            //     commodity_id: 1,
            //     weight: 1.5,
            //     supplier: "AM"
            // },
            //
            // {
            //     commodityBatch_id: 2,
            //     commodity_id: 2,
            //     weight: 2.5,
            //     supplier: "BM"
            // }
            ]
        ;

        /** Show modal to add an object */
        function showModal(showAddButton) {
            document.getElementById('modal-view').style.display = 'flex';




            if (showAddButton) {
                document.getElementById('modal-add').style.display = 'block';
                document.getElementById('modal-update').style.display = 'none';
                // To allow user to write in id field
                document.getElementById('commodityBatch_id-input').disabled = false
            }
        }


        /** Add element to dataBase */
        function addElement() {

            let element = [];

            // Store user input in variables
            let commodityBatch_id = document.getElementById('commodityBatch_id-input').value;
            let commodity_id = document.getElementById('commodity_id-input').value;
            let weight = document.getElementById('weight-input').value;
            let supplier = document.getElementById('supplier-input').value;

            // To add attributes to data base if all attributes are not empty
            if (commodityBatch_id && commodity_id && weight && supplier) {
                elements = [{
                    commodityBatch_id: commodityBatch_id,
                    commodity_id: commodity_id,
                    weight: weight,
                    supplier: supplier
                }];

                $.ajax({
                    url: 'https://api.mama.sh/cdio/api/commodityBatch',
                    method: 'POST',
                    contentType: "application/json",
                    data: JSON.stringify(elements),
                    success: function (elements) {
                        // Display element
                        showElementsAuto(elements)
                    },
                    error: function (jqXHR, textStatus, error) {
                        alert(jqXHR.responseText + textStatus + error)
                    }
                });
            }
                /*elements.push ({
                    commodityBatch_id: commodityBatch_id,
                    commodity_id: commodity_id,
                    weight: weight,
                    supplier: supplier
                });}*/



            // Display element
            showElementsAuto(elements)

            // To hide the modal after creating an object
            hideModal()
        }

        /** To hide modal and make fields empty */
        function hideModal(updateButton) {
            document.getElementById('modal-view').style.display = 'none'

            if (updateButton)
                document.getElementById('modal-update').style.display = 'none';

            // Make the fields empty
            document.getElementById('commodityBatch_id-input').value = ''
            document.getElementById('commodity_id-input').value = ''
            document.getElementById('weight-input').value = ''
            document.getElementById('supplier-input').value = ''
        }

        /** To Show all elements */
        function showElementsAuto(elements) {
            const single_element = document.getElementById('commodityBatch-list');

            while (single_element.firstChild) single_element.removeChild(single_element.lastChild)



            for (element of elements) {
                    single_element.insertAdjacentHTML('beforebegin', `
                                                <div class="bg-gray-400 flex p-2">
                                                <div class="cursor-pointer text-green-600">ID: ${element.commodityBatch_id} </div>
                                                <div class="ml-auto">
                                                <button onclick="showElementInfo('${element.commodityBatch_id}', false)" class="cursor-pointer text-green-600">Element Information</button>
                                                <button onclick="showElementInfo('${element.commodityBatch_id}', true)" class="cursor-pointer text-green-600">U</button>
                                                <button class="text-red-600">X</button>
                                                </div>
                                                </div>
                                                `)
            }
        }


        /** Show element information */
        function showElementInfo(commodityBatch_id, showUpdateButton){
            let element = elements[
                elements.findIndex(element => element.commodityBatch_id === commodityBatch_id)]


            document.getElementById('modal-add').style.display = 'none'
            if (showUpdateButton) {
                // To not allow user to write in id field
                document.getElementById('commodityBatch_id-input').disabled = true
                document.getElementById('modal-update').style.display = 'block'
            }



            document.getElementById('commodityBatch_id-input').value = element.commodityBatch_id;
            document.getElementById('commodity_id-input').value = element.commodity_id;
            document.getElementById('weight-input').value = element.weight;
            document.getElementById('supplier-input').value = element.supplier;


            showModal();

        }



        /** Show element information with ajax */
       /* function showElementInfo(commodityBatch_id) {
            console.log("showElementInfo");
            $.ajax({
                url  : 'REST/Resources/commodityBatch/' + commodityBatch_id,
                contentType : "application/json",
                type : "GET",
                success : function (response) {
                    document.getElementById('modal-add').style.display = 'none'
                    $('#commodityBatch_id-input').val(response.commodityBatch_id)
                    $('#commodity_id-input').val(response.commodity_id)
                    $('#weight-input').val(response.weight)
                    $('#supplier-input').val(response.supplier)
                },
                error: function (jqXHR, text, error) {
                    /!** The user can search if we have a specific element or not *!/
                }

            });

            // To show element information
            showModal();
        }*/



        /** Update element */
        function updateElement(commodityBatch_id) {
             elements[
                elements.findIndex(element => element.commodityBatch_id === commodityBatch_id)
                ] = {
                 commodityBatch_id: commodityBatch_id,
                 commodity_id: document.getElementById('commodity_id-input').value,
                 weight: document.getElementById('weight-input').value,
                 supplier: document.getElementById('supplier-input').value,
             }

            // To hide the modal after creating an object
            hideModal(true)

        }

        /** Search for element */
        function searchForElement() {

        }





    </script>


    </body>
</html>
